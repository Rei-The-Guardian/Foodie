<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoodieExpress - ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts (Sarabun) -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Sarabun', sans-serif; }
        
        /* Animations */
        @keyframes slide-left { from { transform: translateX(100%); } to { transform: translateX(0); } }
        @keyframes scale-in { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes bounce-in { 0% { transform: scale(0.3); opacity: 0; } 50% { transform: scale(1.05); } 70% { transform: scale(0.9); } 100% { transform: scale(1); opacity: 1; } }
        @keyframes bounce-short { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-25%); } }
        
        .animate-slide-left { animation: slide-left 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        .animate-scale-in { animation: scale-in 0.2s ease-out; }
        .animate-bounce-in { animation: bounce-in 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        .animate-bounce-short { animation: bounce-short 1s infinite; }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-orange-50 text-slate-800 pb-24 md:pb-0">

    <!-- Header -->
    <header class="sticky top-0 z-30 bg-white/95 backdrop-blur-sm border-b border-orange-100 px-4 py-3 md:px-8 flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-2">
            <div class="bg-gradient-to-br from-orange-400 to-yellow-500 p-2 rounded-xl text-white shadow-orange-200 shadow-lg">
                <i data-lucide="utensils" width="20"></i>
            </div>
            <div>
                <h1 class="text-xl font-extrabold text-slate-800 leading-none">Foodie<span class="text-orange-500">Express</span></h1>
                <p class="text-[10px] text-slate-400 font-medium">‡∏≠‡∏£‡πà‡∏≠‡∏¢ ‡∏™‡∏±‡πà‡∏á‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏î‡πâ‡πÑ‡∏ß</p>
            </div>
        </div>

        <div class="flex items-center gap-3">
            <!-- AI Button (Desktop) -->
            <button onclick="toggleAIModal()" class="hidden md:flex items-center gap-2 px-4 py-2 bg-indigo-50 hover:bg-indigo-100 text-indigo-600 rounded-full font-bold text-xs transition-colors border border-indigo-200">
                <i data-lucide="sparkles" width="14" class="animate-pulse"></i>
                <span>‡πÉ‡∏´‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
            </button>

            <!-- Cart Button -->
            <button onclick="toggleCart()" class="relative p-2.5 bg-orange-50 hover:bg-orange-100 text-orange-600 rounded-full transition-colors group">
                <i data-lucide="shopping-cart" width="22" class="group-hover:scale-110 transition-transform"></i>
                <span id="cart-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full border-2 border-white font-bold animate-bounce-short">0</span>
            </button>
        </div>
    </header>

    <!-- Mobile AI Button -->
    <button onclick="toggleAIModal()" class="md:hidden fixed bottom-6 left-1/2 -translate-x-1/2 z-40 bg-indigo-600 text-white px-6 py-3 rounded-full shadow-lg shadow-indigo-300 flex items-center gap-2 font-bold animate-bounce-in">
        <i data-lucide="sparkles" width="18"></i>
        <span>‡πÉ‡∏´‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
    </button>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 py-6">
        <!-- Banner -->
        <div class="mb-8 relative overflow-hidden rounded-2xl bg-gradient-to-r from-orange-500 to-yellow-500 shadow-xl shadow-orange-200">
            <div class="p-6 md:p-8 text-white relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <div class="inline-block px-3 py-1 bg-white/20 backdrop-blur-md rounded-full text-xs font-bold mb-2 border border-white/30">
                        üéâ ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©
                    </div>
                    <h2 class="text-2xl md:text-3xl font-bold mb-1">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 10% ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</h2>
                    <p class="opacity-90 text-sm md:text-base">‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î <span class="font-mono bg-white text-orange-600 px-2 rounded font-bold">WELCOME10</span> ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏ö 200.-</p>
                </div>
                <div class="hidden md:block text-8xl opacity-20 absolute right-4 -bottom-4 rotate-12 select-none">üçî</div>
            </div>
            <div class="absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 rounded-full bg-white opacity-10 blur-2xl"></div>
            <div class="absolute bottom-0 left-0 -ml-16 -mb-16 w-40 h-40 rounded-full bg-yellow-300 opacity-20 blur-xl"></div>
        </div>

        <!-- Categories -->
        <div id="category-list" class="flex gap-3 overflow-x-auto pb-6 scrollbar-hide -mx-4 px-4 md:mx-0 md:px-0">
            <!-- Categories will be injected here -->
        </div>

        <!-- Product Grid -->
        <div id="product-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
            <!-- Products will be injected here -->
        </div>
    </main>

    <!-- Product Detail Modal -->
    <div id="product-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeProductModal()"></div>
        <div class="relative bg-white w-full max-w-md rounded-3xl overflow-hidden shadow-2xl animate-scale-in flex flex-col max-h-[90vh]">
            <!-- Content Injected via JS -->
            <div class="relative h-64 bg-orange-100 shrink-0" id="modal-image-container"></div>
            
            <div class="p-6 flex-1 overflow-y-auto">
                <div class="flex justify-between items-start mb-2">
                    <h2 id="modal-name" class="text-2xl font-bold text-slate-800"></h2>
                    <span id="modal-price" class="text-2xl font-bold text-orange-500"></span>
                </div>
                <p id="modal-desc" class="text-slate-500 text-sm mb-4 leading-relaxed"></p>

                <!-- AI Nutrition -->
                <div class="mb-6">
                    <div id="ai-nutrition-btn-container">
                        <button onclick="analyzeNutrition()" class="flex items-center gap-2 text-xs font-bold text-indigo-600 bg-indigo-50 px-3 py-2 rounded-lg hover:bg-indigo-100 transition-colors w-fit">
                            <i data-lucide="sparkles" width="14"></i> ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ (AI)
                        </button>
                    </div>
                    <div id="ai-nutrition-loading" class="hidden flex items-center gap-2 text-xs text-indigo-500 animate-pulse bg-indigo-50 px-3 py-2 rounded-lg w-fit mt-2">
                        <i data-lucide="loader" width="14" class="animate-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                    </div>
                    <div id="ai-nutrition-result" class="hidden bg-indigo-50 p-4 rounded-xl border border-indigo-100 text-sm relative mt-2 animate-scale-in">
                        <div class="absolute -top-2 -right-2 bg-indigo-500 text-white text-[10px] px-2 py-0.5 rounded-full font-bold">AI Guru</div>
                        <div id="ai-nutrition-text" class="whitespace-pre-line text-slate-700 leading-relaxed"></div>
                    </div>
                </div>

                <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 mb-6">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block flex items-center gap-1">
                        <i data-lucide="message-square" width="12"></i> ‡πÇ‡∏ô‡πâ‡∏ï‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏£‡∏±‡∏ß (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)
                    </label>
                    <textarea id="modal-note" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏ú‡∏±‡∏Å, ‡πÄ‡∏ú‡πá‡∏î‡∏ô‡πâ‡∏≠‡∏¢, ‡∏Ç‡∏≠‡∏ä‡πâ‡∏≠‡∏ô‡∏™‡πâ‡∏≠‡∏°" class="w-full bg-white border border-slate-200 rounded-lg p-3 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500 transition-all resize-none" rows="2"></textarea>
                </div>

                <div class="flex items-center justify-between gap-4">
                    <div class="flex items-center gap-4 bg-slate-100 rounded-xl px-4 py-2">
                        <button onclick="updateModalQuantity(-1)" class="p-1 hover:text-orange-500 transition-colors"><i data-lucide="minus" width="20"></i></button>
                        <span id="modal-quantity" class="font-bold text-lg min-w-[1.5rem] text-center">1</span>
                        <button onclick="updateModalQuantity(1)" class="p-1 hover:text-orange-500 transition-colors"><i data-lucide="plus" width="20"></i></button>
                    </div>
                    <button onclick="addToCartFromModal()" id="modal-add-btn" class="flex-1 bg-orange-500 hover:bg-orange-600 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-orange-200 transition-all flex justify-center items-center gap-2 active:scale-95">
                        ‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                    </button>
                </div>
            </div>
            <button onclick="closeProductModal()" class="absolute top-4 right-4 bg-black/20 hover:bg-black/40 text-white p-2 rounded-full backdrop-blur-md transition-colors z-10">
                <i data-lucide="x" width="20"></i>
            </button>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div id="cart-sidebar" class="hidden fixed inset-0 z-50 flex justify-end">
        <div class="absolute inset-0 bg-slate-900/20 backdrop-blur-sm" onclick="toggleCart()"></div>
        <div class="relative w-full max-w-md bg-white h-full shadow-2xl flex flex-col animate-slide-left">
            <div class="p-5 border-b bg-white z-10 flex justify-between items-center shadow-sm">
                <h2 class="text-xl font-bold flex items-center gap-2 text-slate-800">
                    <i data-lucide="shopping-cart" class="text-orange-500" width="24"></i> ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </h2>
                <button onclick="toggleCart()" class="bg-slate-100 p-2 rounded-full hover:bg-slate-200 transition-colors">
                    <i data-lucide="x" width="20"></i>
                </button>
            </div>

            <div id="cart-items" class="flex-1 overflow-y-auto p-5 space-y-4 bg-slate-50/50">
                <!-- Items injected here -->
            </div>

            <div class="p-5 bg-white border-t shadow-[0_-5px_20px_rgba(0,0,0,0.05)] z-10">
                <!-- Coupon -->
                <div id="coupon-section" class="mb-4 hidden">
                    <div class="flex gap-2">
                        <div class="relative flex-1">
                            <i data-lucide="tag" class="absolute left-3 top-3 text-slate-400" width="16"></i>
                            <input type="text" id="coupon-input" placeholder="‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (WELCOME10)" class="w-full pl-9 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-orange-500 transition-all uppercase placeholder:normal-case">
                        </div>
                        <button id="coupon-btn" onclick="applyCoupon()" class="bg-slate-800 text-white px-4 rounded-xl font-bold text-sm hover:bg-slate-700 transition-colors">‡πÉ‡∏ä‡πâ</button>
                    </div>
                    <p id="coupon-msg" class="text-xs mt-1 ml-1"></p>
                </div>

                <div class="space-y-2 mb-4 text-sm">
                    <div class="flex justify-between text-slate-500">
                        <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                        <span id="cart-subtotal">‡∏ø0</span>
                    </div>
                    <div id="cart-discount-row" class="hidden flex justify-between text-green-600 font-medium">
                        <span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</span>
                        <span id="cart-discount">-‡∏ø0</span>
                    </div>
                    <div class="flex justify-between text-lg font-extrabold text-slate-800 pt-2 border-t border-slate-100">
                        <span>‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                        <span id="cart-total">‡∏ø0</span>
                    </div>
                </div>

                <div id="min-order-alert" class="hidden bg-orange-50 text-orange-600 text-xs p-3 rounded-xl mb-4 border border-orange-100 flex items-center gap-2">
                    <div class="bg-orange-100 p-1 rounded-full"><i data-lucide="plus" width="10"></i></div>
                    <span id="min-order-text">‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ ‡∏ø100</span>
                </div>

                <button id="checkout-btn" onclick="openCheckout()" disabled class="w-full bg-orange-500 hover:bg-orange-600 disabled:bg-slate-200 disabled:text-slate-400 disabled:cursor-not-allowed text-white font-bold py-4 rounded-xl shadow-lg shadow-orange-200 transition-all flex justify-between items-center px-6">
                    <span>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á)</span>
                    <span id="checkout-btn-total" class="bg-white/20 px-2 py-1 rounded-lg text-sm">‡∏ø0</span>
                </button>
            </div>
        </div>
    </div>

    <!-- AI Modal -->
    <div id="ai-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-indigo-900/60 backdrop-blur-sm" onclick="toggleAIModal()"></div>
        <div class="relative bg-white w-full max-w-md rounded-3xl p-6 shadow-2xl animate-scale-in border-4 border-indigo-100">
            <button onclick="toggleAIModal()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600">
                <i data-lucide="x" width="24"></i>
            </button>
            
            <div class="text-center mb-6">
                <div class="inline-flex bg-indigo-100 p-3 rounded-full mb-3 text-indigo-600">
                    <i data-lucide="brain" width="32"></i>
                </div>
                <h2 class="text-2xl font-bold text-slate-800">‡πÉ‡∏´‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏∑‡πâ‡∏≠‡∏≠‡∏£‡πà‡∏≠‡∏¢</h2>
                <p class="text-slate-500 text-sm">‡∏ö‡∏≠‡∏Å‡πÄ‡∏£‡∏≤‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏≤‡∏ô‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô</p>
            </div>

            <div class="mb-4 relative">
                <input type="text" id="ai-prompt" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏¢‡∏≤‡∏Å‡∏Å‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ã‡πà‡∏ö‡πÜ, ‡∏Ç‡∏≠‡πÅ‡∏Ñ‡∏•‡∏ô‡πâ‡∏≠‡∏¢‡πÜ, ‡∏≠‡∏Å‡∏´‡∏±‡∏Å‡∏£‡∏±‡∏Å‡∏Ñ‡∏∏‡∏î" class="w-full bg-slate-50 border border-slate-200 rounded-2xl py-4 px-4 pr-12 text-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all shadow-inner">
                <button onclick="askAI()" id="ai-submit-btn" class="absolute right-2 top-2 bottom-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-slate-300 text-white p-2.5 rounded-xl transition-all flex items-center justify-center aspect-square shadow-lg shadow-indigo-200">
                    <i data-lucide="sparkles" width="20"></i>
                </button>
            </div>

            <!-- AI Content Container -->
            <div id="ai-content">
                <!-- Tags -->
                <div id="ai-tags" class="flex flex-wrap gap-2 justify-center mt-4">
                    <button onclick="setAIPrompt('‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô‡πÅ‡∏Å‡πâ‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î')" class="text-xs bg-white border border-slate-200 text-slate-500 px-3 py-1.5 rounded-full hover:bg-indigo-50 hover:text-indigo-600 transition-colors">‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô‡πÅ‡∏Å‡πâ‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î</button>
                    <button onclick="setAIPrompt('‡πÄ‡∏ô‡πâ‡∏ô‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô')" class="text-xs bg-white border border-slate-200 text-slate-500 px-3 py-1.5 rounded-full hover:bg-indigo-50 hover:text-indigo-600 transition-colors">‡πÄ‡∏ô‡πâ‡∏ô‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô</button>
                    <button onclick="setAIPrompt('‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏á‡∏ö')" class="text-xs bg-white border border-slate-200 text-slate-500 px-3 py-1.5 rounded-full hover:bg-indigo-50 hover:text-indigo-600 transition-colors">‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏á‡∏ö</button>
                    <button onclick="setAIPrompt('‡∏£‡∏™‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏ô')" class="text-xs bg-white border border-slate-200 text-slate-500 px-3 py-1.5 rounded-full hover:bg-indigo-50 hover:text-indigo-600 transition-colors">‡∏£‡∏™‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏ô</button>
                </div>
                <!-- Result will be injected here -->
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-md" onclick="closeCheckout()"></div>
        <div class="relative bg-white w-full max-w-lg rounded-3xl p-6 md:p-8 shadow-2xl animate-scale-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-slate-800">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>
                <div class="bg-orange-100 text-orange-700 text-xs font-bold px-3 py-1 rounded-full">COD ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</div>
            </div>
            
            <form onsubmit="confirmOrder(event)" class="space-y-4">
                <div class="space-y-4">
                    <div class="relative">
                        <i data-lucide="user" class="absolute left-3 top-3.5 text-slate-400" width="18"></i>
                        <input required type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö" class="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 transition-all text-sm font-medium">
                    </div>
                    <div class="relative">
                        <i data-lucide="phone" class="absolute left-3 top-3.5 text-slate-400" width="18"></i>
                        <input required type="tel" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" class="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 transition-all text-sm font-medium">
                    </div>
                    <div class="relative">
                        <i data-lucide="map-pin" class="absolute left-3 top-3.5 text-slate-400" width="18"></i>
                        <textarea required placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á (‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏ã‡∏≠‡∏¢, ‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï)" rows="3" class="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 transition-all text-sm font-medium resize-none"></textarea>
                    </div>
                </div>

                <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 mt-4">
                    <h3 class="font-bold text-slate-700 mb-2 text-sm">‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞</h3>
                    <div class="flex justify-between text-sm text-slate-500 mb-1">
                        <span>‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
                        <span id="confirm-subtotal">‡∏ø0</span>
                    </div>
                    <div class="flex justify-between text-sm text-green-600 mb-2">
                        <span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</span>
                        <span id="confirm-discount">-</span>
                    </div>
                    <div class="flex justify-between font-extrabold text-lg text-slate-800 pt-2 border-t border-slate-200">
                        <span>‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞ (‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î)</span>
                        <span id="confirm-total">‡∏ø0</span>
                    </div>
                </div>

                <div class="pt-2 flex gap-3">
                    <button type="button" onclick="closeCheckout()" class="flex-1 py-3.5 text-slate-500 font-bold border border-slate-200 rounded-xl hover:bg-slate-50 transition-colors">
                        ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                    </button>
                    <button type="submit" class="flex-[2] py-3.5 bg-orange-500 text-white font-bold rounded-xl hover:bg-orange-600 transition-colors shadow-lg shadow-orange-100 flex items-center justify-center gap-2">
                        <span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</span>
                        <i data-lucide="chevron-right" width="18"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="hidden fixed inset-0 z-[70] flex items-center justify-center p-4 bg-orange-500/95 backdrop-blur-sm">
        <div class="text-center text-white animate-bounce-in max-w-sm w-full bg-white/10 p-8 rounded-3xl border border-white/20 shadow-2xl">
            <div class="bg-white text-orange-500 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl">
                <i data-lucide="check-circle" width="50"></i>
            </div>
            <h2 class="text-3xl font-extrabold mb-2">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß!</h2>
            <p class="text-orange-50 text-sm mb-8 leading-relaxed">‡∏û‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡∏ß‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∏‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì<br/>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏£‡πà‡∏≠‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
            <button onclick="closeSuccess()" class="w-full bg-white text-orange-600 font-bold py-3.5 rounded-xl hover:bg-orange-50 transition-colors shadow-lg">
                ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å
            </button>
        </div>
    </div>

    <script>
        // --- Data & Config ---
        const apiKey = "AIzaSyAd6p8y-Ro1Q_kUgBa_CuGPqd1RxPen2bA"; // ‡πÉ‡∏™‡πà Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
        const MIN_ORDER = 100;
        const MENU_ITEMS = [
            { id: 1, name: '‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß', price: 65, category: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß', emoji: 'üçõ', description: '‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡πÅ‡∏ó‡πâ ‡∏ú‡∏±‡∏î‡πÅ‡∏´‡πâ‡∏á‡πÜ ‡∏´‡∏≠‡∏°‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏Å‡∏£‡∏∞‡∏ó‡∏∞ ‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß‡∏Å‡∏£‡∏≠‡∏ö‡πÜ', image: 'https://img.wongnai.com/p/1920x0/2019/03/14/fc08ab22f3ac4135b292eda27cc872f9.jpg' },
            { id: 2, name: '‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏´‡∏°‡∏π', price: 60, category: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß', emoji: 'üçö', description: '‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏•‡∏¥‡∏ú‡∏±‡∏î‡∏à‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏™‡∏ß‡∏¢ ‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡∏Å‡∏•‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏°', image: 'https://s359.kapook.com/pagebuilder/2810e9c2-ac36-4970-bc50-d2fa431e2c3c.jpg' },
            { id: 3, name: '‡∏ú‡∏±‡∏î‡πÑ‡∏ó‡∏Å‡∏∏‡πâ‡∏á‡∏™‡∏î', price: 85, category: '‡πÄ‡∏™‡πâ‡∏ô', emoji: 'üçú', description: '‡πÄ‡∏™‡πâ‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡πå‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡∏ô‡∏∏‡πà‡∏° ‡∏ã‡∏≠‡∏™‡∏°‡∏∞‡∏Ç‡∏≤‡∏°‡∏™‡∏π‡∏ï‡∏£‡πÇ‡∏ö‡∏£‡∏≤‡∏ì ‡∏Å‡∏∏‡πâ‡∏á‡∏ï‡∏±‡∏ß‡πÇ‡∏ï', image: 'https://www.unileverfoodsolutions.co.th/dam/global-ufs/mcos/SEA/calcmenu/recipes/TH-recipes/pasta-dishes/%E0%B8%9C%E0%B8%B1%E0%B8%94%E0%B9%84%E0%B8%97%E0%B8%A2%E0%B8%81%E0%B8%B8%E0%B9%89%E0%B8%87%E0%B8%AA%E0%B8%94/%E0%B8%9C%E0%B8%B1%E0%B8%94%E0%B9%84%E0%B8%97%E0%B8%A2%E0%B8%81%E0%B8%B8%E0%B9%89%E0%B8%87%E0%B8%AA%E0%B8%94_header.jpg' }, // Test error image
            { id: 4, name: '‡∏™‡πâ‡∏°‡∏ï‡∏≥‡πÑ‡∏ó‡∏¢', price: 55, category: '‡∏™‡πâ‡∏°‡∏ï‡∏≥/‡∏¢‡∏≥', emoji: 'ü•ó', description: '‡∏°‡∏∞‡∏•‡∏∞‡∏Å‡∏≠‡∏Å‡∏£‡∏≠‡∏ö ‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡πÄ‡∏õ‡∏£‡∏µ‡πâ‡∏¢‡∏ß‡∏´‡∏ß‡∏≤‡∏ô ‡πÄ‡∏ú‡πá‡∏î‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏µ ‡∏ñ‡∏±‡πà‡∏ß‡∏Ñ‡∏±‡πà‡∏ß‡πÉ‡∏´‡∏°‡πà', image: 'https://f.ptcdn.info/645/047/000/ohl4zjyn4DbiuAARqzW-o.jpg' },
            { id: 5, name: '‡πÑ‡∏Å‡πà‡∏¢‡πà‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏∞‡πÇ‡∏û‡∏Å', price: 45, category: '‡∏Ç‡∏≠‡∏á‡∏ó‡∏≤‡∏ô‡πÄ‡∏•‡πà‡∏ô', emoji: 'üçó', description: '‡∏´‡∏°‡∏±‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏®‡∏Ç‡πâ‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ô ‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏≠‡πà‡∏≠‡∏ô‡∏à‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏Å‡∏£‡∏≠‡∏ö ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏â‡πà‡∏≥', image: 'https://f.ptcdn.info/724/032/000/1435080904-DSC0099JPG-o.jpg' },
            { id: 6, name: '‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢‡πÄ‡∏¢‡πá‡∏ô', price: 40, category: '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°', emoji: 'ü•§', description: '‡∏ä‡∏≤‡πÅ‡∏î‡∏á‡∏ä‡∏á‡∏™‡∏î ‡∏´‡∏ß‡∏≤‡∏ô‡∏°‡∏±‡∏ô ‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô‡∏ñ‡∏∂‡∏á‡πÉ‡∏à', image: 'https://iel.co.th/wp-content/uploads/2025/07/%E0%B8%8A%E0%B8%B2%E0%B9%84%E0%B8%97%E0%B8%A2%E0%B9%84%E0%B8%A1%E0%B9%88%E0%B9%83%E0%B8%AA%E0%B9%88%E0%B8%AA%E0%B8%B5-3_0-1024x1024.jpg' },
            { id: 7, name: '‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏ç‡∏ä‡∏±‡∏ô‡∏°‡∏∞‡∏ô‡∏≤‡∏ß', price: 35, category: '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°', emoji: 'üçπ', description: '‡∏™‡∏î‡∏ä‡∏∑‡πà‡∏ô ‡∏î‡∏±‡∏ö‡∏Å‡∏£‡∏∞‡∏´‡∏≤‡∏¢ ‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∞‡∏ô‡∏≤‡∏ß‡∏™‡∏î‡πÅ‡∏ó‡πâ', image: 'https://img.wongnai.com/p/1920x0/2019/04/16/da9245c8c5ac4636b5b91995c9e2c7bf.jpg' },
            { id: 8, name: '‡∏ö‡∏±‡∏ß‡∏•‡∏≠‡∏¢‡πÑ‡∏Ç‡πà‡∏´‡∏ß‡∏≤‡∏ô', price: 50, category: '‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô', emoji: 'ü•£', description: '‡πÅ‡∏õ‡πâ‡∏á‡∏ô‡∏∏‡πà‡∏° ‡∏Å‡∏∞‡∏ó‡∏¥‡∏´‡∏≠‡∏°‡∏Ñ‡∏ß‡∏±‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô ‡πÑ‡∏Ç‡πà‡∏´‡∏ß‡∏≤‡∏ô‡∏¢‡∏≤‡∏á‡∏°‡∏∞‡∏ï‡∏π‡∏°', image: 'https://img.kapook.com/u/2022/wanwanat/1079595941.jpg' },
        ];
        const CATEGORIES = ['‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', ...new Set(MENU_ITEMS.map(item => item.category))];
        const COUPONS = {
            'WELCOME10': { type: 'percent', value: 10, min: 200 },
            'FREE50': { type: 'fixed', value: 50, min: 300 }
        };

        // --- State ---
        let state = {
            cart: [],
            activeCategory: '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
            selectedItem: null,
            modalQuantity: 1,
            appliedCoupon: null
        };

        // --- DOM Helpers ---
        const $ = (id) => document.getElementById(id);
        const formatMoney = (num) => `‡∏ø${num.toLocaleString()}`;

        // --- Render Functions ---

        function renderCategories() {
            const container = $('category-list');
            container.innerHTML = CATEGORIES.map(cat => `
                <button onclick="filterCategory('${cat}')" 
                    class="whitespace-nowrap px-5 py-2 rounded-full text-sm font-semibold transition-all ${state.activeCategory === cat ? 'bg-slate-800 text-white shadow-lg shadow-slate-200 scale-105' : 'bg-white text-slate-500 border border-slate-100 hover:bg-orange-50 hover:text-orange-500'}">
                    ${cat}
                </button>
            `).join('');
        }

        function renderProducts() {
            const container = $('product-grid');
            const filtered = state.activeCategory === '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' 
                ? MENU_ITEMS 
                : MENU_ITEMS.filter(i => i.category === state.activeCategory);

            container.innerHTML = filtered.map(item => `
                <div onclick="openProductModal(${item.id})" class="bg-white rounded-2xl p-3 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer group border border-slate-100">
                    <div class="relative aspect-square mb-3 overflow-hidden rounded-xl bg-orange-50">
                        <img src="${item.image}" alt="${item.name}" 
                             onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\\'flex items-center justify-center bg-orange-50 text-5xl w-full h-full\\'>${item.emoji}</div>'"
                             class="object-cover w-full h-full group-hover:scale-110 transition-transform duration-500">
                        <div class="absolute bottom-2 right-2 bg-white/90 backdrop-blur rounded-lg p-1.5 shadow-sm opacity-0 group-hover:opacity-100 transition-opacity translate-y-2 group-hover:translate-y-0">
                            <i data-lucide="plus" class="text-orange-500" width="16"></i>
                        </div>
                    </div>
                    <div class="space-y-1">
                        <div class="text-[10px] text-orange-500 font-bold uppercase tracking-wider">${item.category}</div>
                        <h3 class="font-bold text-slate-800 line-clamp-1 group-hover:text-orange-600 transition-colors">${item.name}</h3>
                        <div class="flex justify-between items-end">
                            <span class="text-lg font-bold text-slate-900">${formatMoney(item.price)}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function renderCart() {
            const container = $('cart-items');
            
            // Update Badge
            const totalQty = state.cart.reduce((s, i) => s + i.quantity, 0);
            const badge = $('cart-badge');
            badge.innerText = totalQty;
            badge.classList.toggle('hidden', totalQty === 0);

            // Empty State
            if (state.cart.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-slate-400 space-y-4">
                        <div class="w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center">
                            <i data-lucide="shopping-cart" width="40" class="opacity-50"></i>
                        </div>
                        <p class="font-medium">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
                        <button onclick="toggleCart()" class="text-orange-500 font-bold hover:underline">‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏•‡∏¢</button>
                    </div>`;
                $('coupon-section').classList.add('hidden');
                $('checkout-btn').disabled = true;
                $('min-order-alert').classList.add('hidden');
            } else {
                container.innerHTML = state.cart.map((item, index) => `
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 relative group">
                        <div class="flex gap-4">
                            <div class="w-16 h-16 rounded-lg bg-orange-50 flex items-center justify-center text-3xl shrink-0 overflow-hidden">
                                 <img src="${item.image}" onerror="this.onerror=null; this.parentElement.innerHTML='${item.emoji}'" class="w-full h-full object-cover">
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex justify-between items-start mb-1">
                                    <h4 class="font-bold text-slate-800 truncate">${item.name}</h4>
                                    <span class="font-bold text-slate-900">${formatMoney(item.price * item.quantity)}</span>
                                </div>
                                ${item.note ? `<div class="text-xs text-orange-600 bg-orange-50 px-2 py-1 rounded-md inline-block mb-2 max-w-full truncate">üìù ${item.note}</div>` : ''}
                                <div class="flex items-center justify-between mt-2">
                                    <div class="flex items-center gap-3 bg-slate-50 border rounded-lg px-2 py-1 h-8">
                                        <button onclick="updateCartQuantity(${index}, -1)" class="text-slate-500 hover:text-orange-500"><i data-lucide="minus" width="14"></i></button>
                                        <span class="font-bold text-sm min-w-[1rem] text-center">${item.quantity}</span>
                                        <button onclick="updateCartQuantity(${index}, 1)" class="text-slate-500 hover:text-orange-500"><i data-lucide="plus" width="14"></i></button>
                                    </div>
                                    <button onclick="removeFromCart(${index})" class="text-slate-300 hover:text-red-500 transition-colors">
                                        <i data-lucide="trash-2" width="18"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                $('coupon-section').classList.remove('hidden');
            }

            // Calculations
            const subtotal = state.cart.reduce((s, i) => s + (i.price * i.quantity), 0);
            let discount = 0;
            
            if (state.appliedCoupon) {
                if (subtotal >= state.appliedCoupon.min) {
                     discount = state.appliedCoupon.type === 'percent' 
                        ? Math.floor(subtotal * (state.appliedCoupon.value / 100))
                        : state.appliedCoupon.value;
                     $('coupon-msg').innerHTML = `<span class="text-green-600 flex items-center gap-1"><i data-lucide="check-circle" width="12"></i> ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏•‡∏î ${formatMoney(discount)}</span>`;
                     $('coupon-btn').innerText = '‡∏•‡∏ö';
                     $('coupon-btn').onclick = removeCoupon;
                     $('coupon-btn').classList.replace('bg-slate-800', 'bg-red-100');
                     $('coupon-btn').classList.replace('text-white', 'text-red-600');
                } else {
                     state.appliedCoupon = null; // Auto remove if criteria not met
                     $('coupon-msg').innerText = `‡∏¢‡∏≠‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ ${formatMoney(COUPONS[state.appliedCoupon?.code || '']?.min || 0)}`;
                     resetCouponUI();
                }
            } else {
                resetCouponUI();
            }

            const total = subtotal - discount;

            // Update Totals UI
            $('cart-subtotal').innerText = formatMoney(subtotal);
            $('cart-total').innerText = formatMoney(total);
            $('checkout-btn-total').innerText = formatMoney(total);

            if (discount > 0) {
                $('cart-discount-row').classList.remove('hidden');
                $('cart-discount').innerText = `-${formatMoney(discount)}`;
            } else {
                $('cart-discount-row').classList.add('hidden');
            }

            // Min Order Logic
            const minOrderAlert = $('min-order-alert');
            const checkoutBtn = $('checkout-btn');
            
            if (state.cart.length > 0 && total < MIN_ORDER) {
                minOrderAlert.classList.remove('hidden');
                $('min-order-text').innerText = `‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ ${formatMoney(MIN_ORDER)} (‡∏Ç‡∏≤‡∏î‡∏≠‡∏µ‡∏Å ${formatMoney(MIN_ORDER - total)})`;
                checkoutBtn.disabled = true;
            } else {
                minOrderAlert.classList.add('hidden');
                checkoutBtn.disabled = state.cart.length === 0;
            }

            lucide.createIcons();
        }

        // --- Logic Functions ---

        function filterCategory(cat) {
            state.activeCategory = cat;
            renderCategories();
            renderProducts();
        }

        function toggleCart() {
            const sidebar = $('cart-sidebar');
            sidebar.classList.toggle('hidden');
            renderCart();
        }

        // --- Product Modal Logic ---
        function openProductModal(id) {
            const item = MENU_ITEMS.find(i => i.id === id);
            state.selectedItem = item;
            state.modalQuantity = 1;
            
            // Reset AI stuff
            $('ai-nutrition-result').classList.add('hidden');
            $('ai-nutrition-loading').classList.add('hidden');
            $('ai-nutrition-btn-container').classList.remove('hidden');

            // Set Content
            $('modal-image-container').innerHTML = `<img src="${item.image}" onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\\'flex items-center justify-center bg-orange-50 text-5xl w-full h-full\\'>${item.emoji}</div>'" class="h-full w-full object-cover">`;
            $('modal-name').innerText = item.name;
            $('modal-price').innerText = formatMoney(item.price);
            $('modal-desc').innerText = item.description;
            $('modal-quantity').innerText = 1;
            $('modal-note').value = '';
            
            // Update Add Button Text
            updateAddButton();

            $('product-modal').classList.remove('hidden');
        }

        function closeProductModal() {
            $('product-modal').classList.add('hidden');
            state.selectedItem = null;
        }

        function updateModalQuantity(delta) {
            state.modalQuantity = Math.max(1, state.modalQuantity + delta);
            $('modal-quantity').innerText = state.modalQuantity;
            updateAddButton();
        }

        function updateAddButton() {
            if (state.selectedItem) {
                $('modal-add-btn').innerText = `‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ ‚Äî ${formatMoney(state.selectedItem.price * state.modalQuantity)}`;
            }
        }

        function addToCartFromModal() {
            if (!state.selectedItem) return;
            const note = $('modal-note').value.trim();
            
            const existingIndex = state.cart.findIndex(i => i.id === state.selectedItem.id && i.note === note);
            if (existingIndex >= 0) {
                state.cart[existingIndex].quantity += state.modalQuantity;
            } else {
                state.cart.push({ ...state.selectedItem, quantity: state.modalQuantity, note });
            }

            closeProductModal();
            toggleCart(); // Open cart to show item
        }

        // --- Cart Logic ---
        function updateCartQuantity(index, delta) {
            state.cart[index].quantity = Math.max(1, state.cart[index].quantity + delta);
            renderCart();
        }

        function removeFromCart(index) {
            state.cart.splice(index, 1);
            renderCart();
        }

        // --- Coupon Logic ---
        function applyCoupon() {
            const code = $('coupon-input').value.trim().toUpperCase();
            const subtotal = state.cart.reduce((s, i) => s + (i.price * i.quantity), 0);

            if (COUPONS[code]) {
                if (subtotal >= COUPONS[code].min) {
                    state.appliedCoupon = { ...COUPONS[code], code };
                    $('coupon-msg').innerText = '';
                } else {
                    $('coupon-msg').classList.add('text-red-500');
                    $('coupon-msg').innerText = `‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ ${formatMoney(COUPONS[code].min)}`;
                }
            } else {
                $('coupon-msg').classList.add('text-red-500');
                $('coupon-msg').innerText = '‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
            }
            renderCart();
        }

        function removeCoupon() {
            state.appliedCoupon = null;
            $('coupon-input').value = '';
            $('coupon-msg').innerText = '';
            renderCart();
        }

        function resetCouponUI() {
            $('coupon-btn').innerText = '‡πÉ‡∏ä‡πâ';
            $('coupon-btn').onclick = applyCoupon;
            $('coupon-btn').className = 'bg-slate-800 text-white px-4 rounded-xl font-bold text-sm hover:bg-slate-700 transition-colors';
            if (!state.appliedCoupon && $('coupon-msg').innerText.includes('‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à')) {
                $('coupon-msg').innerText = '';
            }
        }

        // --- Checkout Logic ---
        function openCheckout() {
            $('cart-sidebar').classList.add('hidden');
            
            // Calculate totals for summary
            const subtotal = state.cart.reduce((s, i) => s + (i.price * i.quantity), 0);
            let discount = 0;
            if (state.appliedCoupon) {
                 discount = state.appliedCoupon.type === 'percent' ? Math.floor(subtotal * (state.appliedCoupon.value / 100)) : state.appliedCoupon.value;
            }
            const total = subtotal - discount;

            $('confirm-subtotal').innerText = formatMoney(subtotal);
            $('confirm-discount').innerText = discount > 0 ? `-${formatMoney(discount)}` : '-';
            $('confirm-total').innerText = formatMoney(total);

            $('checkout-modal').classList.remove('hidden');
        }

        function closeCheckout() {
            $('checkout-modal').classList.add('hidden');
            $('cart-sidebar').classList.remove('hidden');
        }

        function confirmOrder(e) {
            e.preventDefault();
            $('checkout-modal').classList.add('hidden');
            $('success-modal').classList.remove('hidden');
            state.cart = [];
            state.appliedCoupon = null;
            renderCart();
        }

        function closeSuccess() {
            $('success-modal').classList.add('hidden');
        }

        // --- AI Logic (Gemini) ---
        
        async function callGemini(promptText) {
            if (!apiKey) {
                // Mock response if no API key
                return new Promise(resolve => setTimeout(() => resolve("‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà API Key (‡πÅ‡∏ï‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß)"), 1000));
            }
            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: promptText }] }] }),
                    }
                );
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "AI ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á";
            } catch (error) {
                console.error(error);
                return "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î";
            }
        }

        function toggleAIModal() {
            const modal = $('ai-modal');
            modal.classList.toggle('hidden');
            if (!modal.classList.contains('hidden')) {
                // Reset UI
                $('ai-content').innerHTML = `
                <div id="ai-tags" class="flex flex-wrap gap-2 justify-center mt-4">
                    <button onclick="setAIPrompt('‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô‡πÅ‡∏Å‡πâ‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î')" class="text-xs bg-white border border-slate-200 text-slate-500 px-3 py-1.5 rounded-full hover:bg-indigo-50 hover:text-indigo-600 transition-colors">‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô‡πÅ‡∏Å‡πâ‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î</button>
                    <button onclick="setAIPrompt('‡πÄ‡∏ô‡πâ‡∏ô‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô')" class="text-xs bg-white border border-slate-200 text-slate-500 px-3 py-1.5 rounded-full hover:bg-indigo-50 hover:text-indigo-600 transition-colors">‡πÄ‡∏ô‡πâ‡∏ô‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô</button>
                    <button onclick="setAIPrompt('‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏á‡∏ö')" class="text-xs bg-white border border-slate-200 text-slate-500 px-3 py-1.5 rounded-full hover:bg-indigo-50 hover:text-indigo-600 transition-colors">‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏á‡∏ö</button>
                    <button onclick="setAIPrompt('‡∏£‡∏™‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏ô')" class="text-xs bg-white border border-slate-200 text-slate-500 px-3 py-1.5 rounded-full hover:bg-indigo-50 hover:text-indigo-600 transition-colors">‡∏£‡∏™‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏ô</button>
                </div>`;
                $('ai-prompt').value = '';
            }
        }

        function setAIPrompt(text) {
            $('ai-prompt').value = text;
        }

        async function askAI() {
            const prompt = $('ai-prompt').value.trim();
            if (!prompt) return;

            const contentDiv = $('ai-content');
            const submitBtn = $('ai-submit-btn');
            
            // Loading State
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i data-lucide="loader" class="animate-spin" width="20"></i>';
            lucide.createIcons();

            const menuContext = MENU_ITEMS.map(i => `${i.id}: ${i.name} (${i.category}) - ${i.description}`).join('\n');
            const fullPrompt = `You are a helpful AI food recommender for a Thai restaurant.
            Here is the menu:
            ${menuContext}
            User request: "${prompt}"
            Task: Pick the SINGLE best matching item ID. Return ONLY JSON: { "id": number, "reason": "Short reason in Thai" }`;

            const resultText = await callGemini(fullPrompt);
            
            try {
                const cleanJson = resultText.replace(/```json|```/g, '').trim();
                const result = JSON.parse(cleanJson);
                const item = MENU_ITEMS.find(i => i.id === result.id);

                if (item) {
                    contentDiv.innerHTML = `
                    <div class="animate-scale-in bg-gradient-to-br from-orange-50 to-indigo-50 p-4 rounded-2xl border border-orange-100 relative overflow-hidden mt-4">
                        <div class="absolute top-0 right-0 bg-indigo-500 text-white text-[10px] px-2 py-1 rounded-bl-xl font-bold">AI Selected ‚ú®</div>
                        <div class="flex gap-4 items-center mb-3">
                            <div class="w-16 h-16 rounded-lg overflow-hidden shrink-0">
                                <img src="${item.image}" onerror="this.onerror=null; this.parentElement.innerHTML='${item.emoji}'" class="h-full w-full object-cover">
                            </div>
                            <div>
                                <h3 class="font-bold text-lg text-slate-800">${item.name}</h3>
                                <p class="text-orange-500 font-bold">${formatMoney(item.price)}</p>
                            </div>
                        </div>
                        <div class="bg-white/60 p-3 rounded-xl mb-3 text-sm text-slate-600 italic border border-white/50">"${result.reason}"</div>
                        <button onclick="selectAIItem(${item.id})" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-200">
                            ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î & ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏•‡∏¢
                        </button>
                    </div>`;
                } else {
                    throw new Error("Item not found");
                }
            } catch (e) {
                contentDiv.innerHTML = `<div class="bg-red-50 text-red-500 p-4 rounded-xl text-center text-sm font-medium mt-4">‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ AI ‡∏™‡∏±‡∏ö‡∏™‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡∏•‡∏≠‡∏á‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö</div>`;
            }

            // Reset Btn
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i data-lucide="sparkles" width="20"></i>';
            lucide.createIcons();
        }

        function selectAIItem(id) {
            toggleAIModal();
            openProductModal(id);
        }

        async function analyzeNutrition() {
            if (!state.selectedItem) return;

            $('ai-nutrition-btn-container').classList.add('hidden');
            $('ai-nutrition-loading').classList.remove('hidden');

            const prompt = `Analyze nutrition for Thai dish "${state.selectedItem.name}" (${state.selectedItem.description}). 
            Response in Thai format:
            ‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà: [Approx Kcal]
            ‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô: [High/Medium/Low]
            ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô: [1 sentence benefit]
            ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö: [Person type]`;

            const result = await callGemini(prompt);

            $('ai-nutrition-loading').classList.add('hidden');
            $('ai-nutrition-result').classList.remove('hidden');
            $('ai-nutrition-text').innerText = result;
        }

        // --- Init ---
        renderCategories();
        renderProducts();
        lucide.createIcons();
    </script>
</body>
</html>